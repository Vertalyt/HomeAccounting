import{u as J,b as i,g as f,f as W,M as G,E as K,S as Q,N as k,_ as X,A as Y,i as z,o as n,s as Z,c as d,v as y,t as l,k as S,l as N,a,O as m,P,F as E,r as $,j as _,T as R,U as A,n as b,q as x}from"./index-0a08cbe1.js";import{u as ee,a as M,c as te,b as ae}from"./index.esm-5e993b4e.js";function oe(){const e=J(),o=i(!0),g=i([]),v=i(),V=i(),{isSubmitting:C,handleSubmit:L}=ee(),u=i(),t=i([]),T=i(),h=i(),c=i([]),B=1,{value:D,errorMessage:F,handleBlur:U}=M("amount",te(f("OnlyNumbers")).min(B,`${f("AmountCannotBeLower")}${B}.`).required(f("AmountRequired"))),{value:q,errorMessage:O,handleBlur:I}=M("description",ae().trim().required()),{value:j}=M("type");W(async()=>{let r=await e.getters["categories/list"];r.length||(r=await e.dispatch("categories/list")),r.length&&(g.value=r.filter(s=>s.isDetected===!1),g.value.length&&(u.value=g.value[0].idParrent));let p=await e.getters["card/list"];p.length||(p=await e.dispatch("card/list")),p.length&&(c.value=p.filter(s=>s.isDetected===!1),c.value.length&&(t.value=c.value[0].idParrent)),o.value=!1,G(()=>{v.value=k.FormSelect.init(V.value),h.value=k.FormSelect.init(T.value)})}),K(()=>{v.value&&v.value.destroy&&v.value.destroy(),h.value&&h.value.destroy&&h.value.destroy()});const H=L(async(r,{resetForm:p})=>{try{const s=c.value.find(w=>w.idParrent===t.value);if(r.type==="income"||r.type==="outcome"&&r.amount<s.bill){const w=r.type==="outcome"?s.bill-r.amount:s.bill+r.amount;await e.dispatch("card/update",{...s,bill:w}),c.value=await e.getters["card/list"],await e.dispatch("records/addRecord",{...r,idParrent:u.value,date:new Date().toJSON()}),await Q()||e.dispatch("records/updateServiseDateRecords")}else e.dispatch("setMessage",{type:"warning",value:`${f("NotMoney")} (${r.amount-s.limit})`});p()}catch{}});return{categories:g,selectCategory:V,loading:o,aValue:D,aError:F,aBlur:U,dValue:q,dError:O,dBlur:I,rValue:j,isSubmitting:C,onSubmit:H,current:u,cardModel:t,list:c,selectCard:T,getLocalizedText:f}}const le={name:"RecordView",setup(){return{...oe()}},components:{AppLoading:Y}},re={key:1},se={key:2},ie={key:3},ne={class:"page-title"},de={class:"input-field"},ue=["value"],ce={key:0,class:"input-field"},pe=["value"],me={class:"input-field"},ge={for:"amount"},ve={class:"input-field"},fe={for:"description"},ye={class:"btn waves-effect waves-light",type:"submit"},he=a("i",{class:"material-icons right"},"send",-1);function be(e,o,g,v,V,C){const L=z("AppLoading"),u=z("routerLink");return e.loading?(n(),Z(L,{key:0})):e.list.length?e.categories.length?(n(),d("div",ie,[a("div",ne,[a("h3",null,l(e.getLocalizedText("Menu_record")),1)]),a("form",{class:"form",onSubmit:o[8]||(o[8]=x((...t)=>e.onSubmit&&e.onSubmit(...t),["prevent"]))},[a("div",de,[m(a("select",{ref:"selectCategory","onUpdate:modelValue":o[0]||(o[0]=t=>e.current=t)},[(n(!0),d(E,null,$(e.categories,t=>(n(),d("option",{key:t.idParrent,value:t.idParrent},l(t.title),9,ue))),128))],512),[[P,e.current]]),a("label",null,l(e.getLocalizedText("ChooseCategory")),1)]),e.list.length?(n(),d("div",ce,[m(a("select",{ref:"selectCard","onUpdate:modelValue":o[1]||(o[1]=t=>e.cardModel=t),required:""},[(n(!0),d(E,null,$(e.list,t=>(n(),d("option",{key:t.idParrent,value:t.idParrent},l(t.title),9,pe))),128))],512),[[P,e.cardModel]]),a("label",null,l(e.getLocalizedText("WriteOffCard")),1)])):_("",!0),a("p",null,[a("label",null,[m(a("input",{class:"with-gap",name:"type",type:"radio",required:"",value:"income","onUpdate:modelValue":o[2]||(o[2]=t=>e.rValue=t)},null,512),[[R,e.rValue]]),a("span",null,l(e.getLocalizedText("income")),1)])]),a("p",null,[a("label",null,[m(a("input",{class:"with-gap",name:"type",type:"radio",required:"",value:"outcome","onUpdate:modelValue":o[3]||(o[3]=t=>e.rValue=t)},null,512),[[R,e.rValue]]),a("span",null,l(e.getLocalizedText("costs")),1)])]),a("div",me,[m(a("input",{id:"amount",type:"number",class:b({invalid:e.aError}),"onUpdate:modelValue":o[4]||(o[4]=t=>e.aValue=t),onBlur:o[5]||(o[5]=(...t)=>e.aBlur&&e.aBlur(...t))},null,34),[[A,e.aValue]]),a("label",ge,l(e.getLocalizedText("amount")),1),a("small",{class:b(["helper-text",{invalid:e.aError}])},l(e.aError),3)]),a("div",ve,[m(a("input",{id:"description",type:"text",class:b({invalid:e.dError}),"onUpdate:modelValue":o[6]||(o[6]=t=>e.dValue=t),onBlur:o[7]||(o[7]=(...t)=>e.dBlur&&e.dBlur(...t))},null,34),[[A,e.dValue]]),a("label",fe,l(e.getLocalizedText("description")),1),a("small",{class:b(["helper-text",{invalid:e.dError}])},l(e.dError),3)]),a("button",ye,[y(l(e.getLocalizedText("Create"))+" ",1),he])],32)])):(n(),d("p",se,[y(l(e.getLocalizedText("categoriesNotFound"))+" ",1),S(u,{to:"/categories"},{default:N(()=>[y(l(e.getLocalizedText("AddPepper")),1)]),_:1})])):(n(),d("p",re,[y(l(e.getLocalizedText("CardNotFound")),1),S(u,{to:"/profile"},{default:N(()=>[y(l(e.getLocalizedText("AddPepper")),1)]),_:1})]))}const Ce=X(le,[["render",be]]);export{Ce as default};
